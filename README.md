
### é˜…è¯»ç¬”è®°â€”â€” release 0.1

#### ğŸ ä¸€ã€å‰è¨€

é˜…è¯»å¼€æºé¡¹ç›®æºä»£ç ä¹Ÿæ˜¯æœ‰å¥—è·¯çš„ï¼Œæœ‰äººä¼šç›´æ¥ä»Githubä¸Š forkæˆ–è€…cloneä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œç„¶åå°±å¼€å§‹é˜…è¯»ã€‚è¿™æ˜¯ä¸ç§‘å­¦çš„ã€‚

ä¸€ä¸ªé¡¹ç›®ä¸æ˜¯ä¸€å£æ°”å†™å®Œçš„ï¼Œè€Œæ˜¯ä½œè€…ç»è¿‡å¾ˆå¤šæ¬¡è¿­ä»£æ‰“ç£¨ï¼Œç”šè‡³è¿˜æœ‰å¾ˆå¤šå…¶ä»–å¼€æºè´¡çŒ®è€…å…±åŒçš„ä¸€æ¬¡æ¬¡commitæˆå°±çš„ã€‚è€Œæœ€ä½³çš„å…¥é—¨æ–¹å¼ï¼Œåº”è¯¥æ˜¯ä»é¡¹ç›®çš„æœ€æ—©çš„ä¸€ä¸ªreleaseç‰ˆæœ¬å¼€å§‹ç€æ‰‹é˜…è¯»ã€‚

å› ä¸ºï¼š
1. ä»£ç é‡æœ€å°‘ï¼Œæ–‡ä»¶é‡æœ€å°‘ï¼Œä¾¿äºç«‹å³ç€æ‰‹é˜…è¯»ï¼Œè€Œä¸æ˜¯èŠ±è´¹åŠå¤©æ—¶é—´å»ç«‹å³æ¯ä¸€ä¸ªæ¨¡å—ï¼Œæ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼›
2. æ­¤æ—¶çš„ä»£ç æ˜¯æ ¸å¿ƒä»£ç ã€‚é¡¹ç›®è¿­ä»£è¿‡ç¨‹ä¼šåŠ ä¸Šå¾ˆå¤šå®¹é”™ã€å…¼å®¹ã€å¥å£®æ€§ä»£ç ï¼Œä½†æ˜¯è¿™äº›ä»£ç å¹¶ä¸æ˜¯é¡¹ç›®çš„æ ¸å¿ƒä»£ç ï¼Œè€Œæ˜¯ä¼˜åŒ–ä»£ç ã€‚
3. ä¾¿äºç«‹å³è·‘é€šä»£ç ã€‚

åŸºäºä»¥ä¸Šä¸‰ä¸ªåŸå› ã€‚æˆ‘ä»¬å¼€å¯Flaskçš„æºç é˜…è¯»ä¹‹è·¯ã€‚

#### ğŸ äºŒã€ç¯å¢ƒå‡†å¤‡

Flaskçš„æœ€æ—©releaseç‰ˆæœ¬æ˜¯ 0.1ï¼ŒPythonè§£é‡Šå™¨æ˜¯2.Xç‰ˆæœ¬ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯ç”¨virtualenvæ¥æ–°å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒã€‚å¦å¤–ï¼ŒFlaskè¿˜ä¾èµ–Werkzeugå’ŒJinja2ä¸¤ä¸ªåŒ…ï¼Œ
å¹¶ä¸”è¿™ä¸¤ä¸ªåŒ…å‘å±•åˆ°ç›®å‰ä¹Ÿå·²ç»è¿­ä»£äº†å¾ˆå¤šç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯0.1ç‰ˆæœ¬çš„Flaskï¼Œåº”è¯¥æ˜¯éœ€è¦æ¢å¤åˆ°å½“æ—¶çš„Werkzeugå’ŒJinja2ç‰ˆæœ¬ã€‚æ‰€ä»¥ï¼Œç¯å¢ƒå‡†å¤‡çš„ç›®çš„æ˜¯ä¸ºäº†å°½é‡æ¢å¤åˆ°
0.1ç‰ˆæœ¬å¼€å‘æ—¶å€™çš„ç¯å¢ƒï¼Œæ’é™¤å…¶ä»–å¹²æ‰°ã€‚

é¦–å…ˆ checkout 0.1 ç‰ˆæœ¬

git checkout 0.1

ä¸ºäº†ä¸ç ´å"çŠ¯ç½ªç°åœº"ï¼Œæˆ‘ä»¬ç«‹å³ä»0.1ç‰ˆæœ¬å†æ¬¡checkoutä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œæˆ‘æŠŠå®ƒå‘½åä¸º `source_code_reading_0.1`

åˆ°æ­¤æ—¶ï¼Œä¾èµ–çš„Werkzeugå’ŒJinja2ä¸¤ä¸ªåŒ…è¿˜æ²¡æœ‰å®‰è£…å¥½ï¼Œå¯ä»¥åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹çœ‹åˆ°æœ‰ä¸€ä¸ªåä¸º setup.pyçš„æ–‡ä»¶ï¼Œé‡Œé¢æœ‰ä¾èµ–çš„Werkzeugå’ŒJinja2ä¸¤ä¸ªåŒ…çš„ç‰ˆæœ¬å·ï¼ˆæ³¨æ„é‡Œé¢çš„ä¾èµ–æ˜¯ >=, éœ€è¦æ”¹æˆ == å·ï¼Œæ‰ä¼šå®‰è£…å¯¹åº”çš„ä½ç‰ˆæœ¬å·ï¼Œå¦‚æœä¸è¿™æ ·åšï¼Œï¼‰ã€‚
è¿è¡Œå‘½ä»¤ python setup.py install

ç°åœ¨ï¼Œå·²ç»åˆ°äº†ä¸€ä¸ªå…¨æ–°çš„ 0.1ç‰ˆæœ¬åˆ†æ”¯äº†ï¼Œåœ¨è¿™ä¸ªåˆ†æ”¯ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥éšæ„æ³¨é‡Šã€æ›´æ”¹ã€è°ƒè¯•ï¼Œæœ€åcommitä»£ç ã€‚


#### ğŸ ä¸‰ã€é¡¹ç›®ç»“æ„è¯´æ˜

0.1ç‰ˆæœ¬çš„Flaské¡¹ç›®ç»“æ„(å¸ƒå±€)å¾ˆç®€æ´ï¼Œflaskçš„æ ¸å¿ƒä»£ç å…¨éƒ¨åœ¨flask.pyå•ä¸ªæ¨¡å—ä¸­ï¼ˆåé¢çš„Flaskç‰ˆæœ¬flask.pyè¢«æ…¢æ…¢æŠ½è±¡æˆäº†ä¸€ä¸ªåŒ…ï¼Œé‡Œé¢åŒ…å«å¾ˆå¤šä¸åŒçš„æ¨¡å—æ–‡ä»¶ï¼‰

ä¸‹é¢çš„é¡¹ç›®çš„ç»“æ„

```
flask
    â”œâ”€â”€ LICENSE
    â”œâ”€â”€ Makefile
    â”œâ”€â”€ README
    â”œâ”€â”€ artwork
    â”œâ”€â”€ docs
    â”œâ”€â”€ examples
    â”œâ”€â”€ flask.py
    â”œâ”€â”€ setup.py
    â”œâ”€â”€ tests
    â””â”€â”€ website
```

1. LICENSE æ–‡ä»¶
2. Makefileæ–‡ä»¶ï¼ˆæˆ‘å¾ˆå°‘ç”¨ï¼‰
3. README (æ–‡ä»¶æ²¡æœ‰åç¼€ï¼Œä¸ºäº†æ›´å¥½çš„ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ï¼Œå»ºè®®æ›´æ”¹æˆ.mdæ–‡ä»¶)
4. artwork æ˜¯ä¸€ä¸ªç›®å½•ï¼Œé‡Œé¢æ”¾çš„æ˜¯Flaskçš„logoå›¾ç‰‡æ–‡ä»¶
5. docs æ˜¯ä¸€ä¸ªç›®å½•ï¼Œé‡Œé¢æ˜¯Flaskçš„æ–‡æ¡£
6. examples ä¸€ä¸ªç›®å½•ï¼Œé‡Œé¢æ˜¯ç”¨Flaskåšçš„ä¸¤ä¸ªdemoå°é¡¹ç›®ï¼Œé€‚åˆå…¥é—¨å­¦ä¹ Flask
7. flask.py Flaksçš„æ ¸å¿ƒä»£ç å…¨éƒ¨åœ¨è¿™ä¸€ä¸ªæ–‡ä»¶é‡Œ
8. setup.py
9. tests æµ‹è¯•ç”¨ä¾‹ç›®å½•
10. website Flaskå®˜ç½‘é™æ€æ–‡ä»¶ç›®å½•


#### flask.py ä»£ç ç»“æ„å®è§‚çœ‹

![flaskä»£ç ç»“æœæˆªå›¾](images/flask_structrue.jpg)

æ•´ä¸ªflask.pyæ–‡ä»¶çš„ä»£ç ç»“æ„å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°æ•´ä¸ªæ–‡ä»¶åªæœ‰600+è¡Œä»£ç ï¼Œè€Œä¸”å…¶ä¸­ä¼°è®¡60%éƒ½æ˜¯æ³¨é‡Šè¡Œã€‚å…¶ä¸­æ ¸å¿ƒä»£ç æ˜¯ Flaskç±»çš„å®šä¹‰ ä»¥åŠ æœ€åçš„5è¡Œä»£ç ã€‚

å¦å¤– flask.pyæ–‡ä»¶ä¸­ä¹Ÿå®šä¹‰äº† `Request`ç±»å’Œ`Response`ç±»ï¼Œä»–ä»¬åˆ†åˆ«ç»§æ‰¿äº† werkzeug ä¸­ `RequestBase`å’Œ`ResponseBase`ç±»ï¼Œwerkzeugè¿™ä¸¤ä¸ªç±»å·²ç»å¸®æˆ‘ä»¬åšäº†å‡ ä¹å…¨éƒ¨çš„RequeståŠResponseå°è£…

`_RequestContext`ç±»ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸éå¸¸é‡è¦çš„ç±»ï¼Œä¸‹é¢ä¼šè®²åˆ°è¿™ä¸ªç±»ã€‚

#### ç†è§£ Request Context

```
# context locals
_request_ctx_stack = LocalStack()
current_app = LocalProxy(lambda: _request_ctx_stack.top.app)
request = LocalProxy(lambda: _request_ctx_stack.top.request)
session = LocalProxy(lambda: _request_ctx_stack.top.session)
g = LocalProxy(lambda: _request_ctx_stack.top.g)
```


åœ¨0.5åŠä»¥åç§»åŠ¨åˆ°äº† flask/globals.py ä¸­ã€‚

LocalStackå’ŒLocalProxyéƒ½ç¦»ä¸å¼€Localã€‚Localå®ç°äº†è®¿é—®å…¨å±€å¯¹è±¡è€Œå®é™…å»æ‹¿ç‰¹å®šçº¿ç¨‹localå¯¹è±¡çš„åŠŸèƒ½ã€‚
é¦–å…ˆLocalé€šè¿‡thread.get_identï¼ˆå¦‚æœæ˜¯greenletåˆ™ä¸ºgreenlet.get_identï¼‰æ¥æ‹¿åˆ°ä¸€ä¸ªçº¿ç¨‹idï¼Œè¿™ä¸ªçº¿ç¨‹idæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œå®ƒçš„å€¼æ²¡æœ‰ä»€ä¹ˆå®é™…çš„æ„ä¹‰ï¼Œ
ä½†èƒ½æ ‡è¯†å‡ºæ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹ä¹‹ä¸­ã€‚çœ‹Local.__getattr__çš„å®ç°ï¼Œå®é™…å–çš„å€¼ä¸º self.__storage__[get_ident()](name)ï¼Œself.__storage__æ˜¯ä¸€ä¸ªå®ä¾‹è‡ªå¸¦çš„dictï¼Œ__setattr__å’Œ__delattr__ä¹ŸåŒç†ã€‚

ä»£ç ç¤ºä¾‹

```
>>> local = Local()

# åœ¨çº¿ç¨‹1ä¸­
>>> local.name = 'Alice'

# åœ¨çº¿ç¨‹2ä¸­
>>> local.name = 'Bob'
```

æ‰€å¾—åˆ°çš„æ•ˆæœå°±æ˜¯æˆ‘ä»¬å…¨å±€ç»™local.nameèµ‹äº†å€¼ï¼Œä½†åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ï¼Œå–å€¼æ—¶local.nameå…¶å®æ˜¯ä¸åŒçš„ã€‚

ä½†_request_ctx_stackæ˜¯ä¸€ä¸ªLocalStackï¼Œä»€ä¹ˆæ˜¯LocalStackå‘¢ï¼Œçœ‹åå­—å°±èƒ½æƒ³åˆ°å®ƒæ˜¯ä¸€ä¸ªåŸºäºLocalè€Œè¡ç”Ÿå‡ºæ¥çš„Stackï¼Œ
å†…éƒ¨å­˜å‚¨å®é™…å°±æ˜¯ä¸€ä¸ªpythonçš„listï¼Œå®ƒå®ç°äº†push/popæ–¹æ³•ï¼Œä»¥åŠtopæ¥å–æ ˆé¡¶å…ƒç´ ï¼Œè€Œä¸”ä¹Ÿèƒ½åƒLocalä¸€æ ·ï¼Œä¸åŒçš„çº¿ç¨‹èƒ½è§£æå‡ºä¸åŒçš„Stackã€‚

```
>>> ls = LocalStack()
>>> ls.push(42)
>>> ls.top
42
>>> ls.push(23)
>>> ls.top
23
>>> ls.pop()
23
>>> ls.top
42
```

ä½†flaskæ²¡æœ‰ç›´æ¥ç”¨Localï¼Œè€Œæ˜¯ç”¨äº†LocalProxyï¼Œå¯¹ä¸€ä¸ªLocalProxyå¯¹è±¡çš„æ“ä½œï¼Œå®é™…ä¸Šéƒ½æŒ‡å‘äº†å®ƒæ‰€ä»£ç†çš„localå¯¹è±¡ï¼ˆ`LocalProxy._get_current_object` æ–¹æ³•è·å¾—ï¼‰ã€‚ç”¨LocalProxyæ–¹ä¾¿äº†Localçš„ç®¡ç†ï¼Œåªç”¨å®ä¾‹åŒ–ä¸€ä¸ªLocalå¯¹è±¡ï¼Œè€Œä¸ç”¨å®ä¾‹åŒ–å¾ˆå¤šä¸ªï¼Œé€šè¿‡ä¸åŒçš„LocalProxyæ¥è®¿é—®åŒä¸€ä¸ªLocalçš„ä¸åŒå±æ€§ã€‚

`_RequestContext` å®ç°äº†ä¸€ä¸ªcontextï¼Œåœ¨enterçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯requestçš„å¼€å§‹ï¼Œä¼šå‘ `_request_ctx_stack.push(self)`ï¼Œexitçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯requestç»“æŸæ—¶ï¼Œpopå‡ºã€‚`_RequestContext` å®šä¹‰äº†ä¸€äº›å±æ€§ï¼Œå¦‚ `app/url_adapter/request/session/g` ã€‚é€šè¿‡stackçš„æœºåˆ¶ï¼Œå½“åœ¨è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå…¨å±€çš„ `request/g/session/current_app` æ€»èƒ½æ‹¿åˆ°æ ˆé¡¶å…ƒç´ çš„ç›¸åº”å±æ€§ã€‚

åœ¨werkzeug.localsçš„ä»£ç ä¸­åŠ ä¸Šä¸€äº›printè¯­å¥:

ä»¥ä¸‹æ˜¯å¯¹ä¸€æ¬¡ åœ¨æµè§ˆå™¨ä¸­ è®¿é—® `http://127.0.0.1:5000/`çš„è¾“å‡ºæ—¥å¿—

```
 * Running on http://127.0.0.1:5000/
get_ident(): 140735835550656, name: stack
get_ident(): 140735835550656, name: stack
push: <flask._RequestContext object at 0x10d780090> to stack, after: [<flask._RequestContext object at 0x10d780090>]
get_ident(): 140735835550656, name: stack
get_ident(): 140735835550656, name: stack
_get_current_object called: <Request 'http://127.0.0.1:5000/' [GET]>
get_ident(): 140735835550656, name: stack
get_ident(): 140735835550656, name: stack
_get_current_object called: <Request 'http://127.0.0.1:5000/' [GET]>
get_ident(): 140735835550656, name: stack
get_ident(): 140735835550656, name: stack
get_ident(): 140735835550656, name: stack
get_ident(): 140735835550656, name: stack
pop from stack current [<flask._RequestContext object at 0x10d780090>]
127.0.0.1 - - [22/Oct/2017 23:13:16] "GET / HTTP/1.1" 200 -
```

ä¸ºäº†æ›´å¥½çš„ç†è§£Flaskçš„æºç ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹http://127.0.0.1:5000è®¿é—®ï¼ŒèƒŒåå‘ç”Ÿäº†ä»€ä¹ˆã€‚ä¸‹é¢çš„å›¾æ˜¯å¯¹è¿™ä¸ªè¿‡ç¨‹çš„ä¸€ä¸ªç²—ç³™æè¿°ã€‚

![ä¸€æ¬¡webè¯·æ±‚æµç¨‹å›¾](images/web-wsgi-server-app.jpg)

æˆ‘ä»¬åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶ `run.py`ï¼Œåœ¨å…¶ä¸­å†™å¦‚ä¸‹ä»£ç ï¼Œå¹¶æ‰§è¡Œï¼Œæ­¤æ—¶å°†ä¼šå¼€å¯ä¸€ä¸ªwsgi serverï¼ˆåˆwerkgeugå®ç°ï¼‰

```python
from flask import Flask

app = Flask(__name__)

if __name__ == '__main__':
    app.run()
    
```
å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨çš„åœ°å€æ ä¸­è¾“å…¥ `http://localhost:5000` è®¿é—®åï¼Œæµè§ˆå™¨å°†å‘èµ·ä¸€ä¸ª requestï¼Œå¦‚å›¾ä¸­ â‘  æ‰€ç¤ºã€‚

wsgi server æ”¶åˆ°æµè§ˆå™¨çš„ requestè¯·æ±‚åï¼Œä¼šå¯¹å…¶è¿›è¡Œä¸€å®šçš„è§£æå’ŒåŠ å¼ºåï¼Œå†è°ƒç”¨ flaskçš„ appï¼Œ å¦‚å›¾ä¸­ â‘¡ æ‰€ç¤ºã€‚

é‚£ä¹ˆé‡ç‚¹æ¥äº†ï¼Œwsgi server æ˜¯å¦‚ä½•è°ƒç”¨ flask appçš„å‘¢ï¼Ÿé€šè¿‡é˜…è¯» Flask ç±»çš„å®šä¹‰ï¼Œæˆ‘ä»¬å‘ç°å®ƒå®ç°äº†ä¸€ä¸ª `__call__` å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨è°ƒç”¨ appçš„æ—¶å€™ è‡ªåŠ¨æ‰§è¡Œ, ä¾‹å¦‚ `app()`

```python

def __call__(self, environ, start_response):
    """Shortcut for :attr:`wsgi_app`"""
    return self.wsgi_app(environ, start_response)
        
        
def wsgi_app(self, environ, start_response):
    """The actual WSGI application.  This is not implemented in
    `__call__` so that middlewares can be applied:

        app.wsgi_app = MyMiddleware(app.wsgi_app)

    :param environ: a WSGI environment
    :param start_response: a callable accepting a status code,
                           a list of headers and an optional
                           exception context to start the response
    """
    with self.request_context(environ): 
        rv = self.preprocess_request()
        if rv is None:
            rv = self.dispatch_request()
        response = self.make_response(rv)
        response = self.process_response(response)
        return response(environ, start_response)
```

ä¹Ÿå°±æ˜¯è¯´ wsgi serverä¸­ åœ¨æŸä¸€ä¸ªåœ°æ–¹ä¸€å®šæ‰§è¡Œäº† `app()`è¿™æ ·ä¸€æ¡è¯­å¥ã€‚`__call__`å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ `environ`å’Œ`start_response`, 
environ æ˜¯environmentçš„ç¼©å†™ï¼Œè¡¨ç¤ºçš„æ˜¯requestè¯·æ±‚çš„ä¸Šä¸‹æ–‡ï¼Œä¾‹å¦‚è¯·æ±‚çš„èµ„æºè·¯å¾„ã€http headersç­‰æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`__call__`ä¸­printä¸€ä¸‹ environï¼Œç»“æœå¦‚ä¸‹ã€‚

> {'wsgi.multiprocess': False, 'HTTP_COOKIE': 'remember_token=spacebox|8f685a538ac321a3073f46595c40a3eb731d931a40dec703c0895ecb94c9d1c857e4f009b2059aa7ab31c93051e85e94e2be76264cbec6ee2ca4bbfe44e61c81; session=.eJw9zksKwkAQRdG99DiD6kp_sxmpz2t0YiQxIIh7NyA4PZN73-EyNuzXsDy3A1O43DwsQWofjGo1MxfOPfpwNULtTtQKW8opuqLNKgaD0EiKXIpV1YYccwE7m2svbkNUAemWuHFqowHZWbQ5lZRmjJgiDaFooJjnXkuYgpitx_15zuyPs6Hr68Rjx_Y7_OPnCw0DOtc.DNA_mg.jo6cex9OJ8Vp29H2edWSJn35pbo', 'SERVER_SOFTWARE': 'Werkzeug/0.6.1', 'SCRIPT_NAME': '', 'REQUEST_METHOD': 'GET', 'PATH_INFO': '/', 'SERVER_PROTOCOL': 'HTTP/1.1', 'QUERY_STRING': '', 'CONTENT_LENGTH': '', 'HTTP_USER_AGENT': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36', 'HTTP_CONNECTION': 'keep-alive', 'SERVER_NAME': '127.0.0.1', 'REMOTE_PORT': 64102, 'HTTP_ALEXATOOLBAR_ALX_NS_PH': 'AlexaToolbar/alx-4.0', 'wsgi.url_scheme': 'http', 'SERVER_PORT': '5000', 'wsgi.input': <socket._fileobject object at 0x110d13d50>, 'HTTP_HOST': '127.0.0.1:5000', 'wsgi.multithread': False, 'HTTP_UPGRADE_INSECURE_REQUESTS': '1', 'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8', 'wsgi.version': (1, 0), 'wsgi.run_once': False, 'wsgi.errors': <open file '<stderr>', mode 'w' at 0x1100e01e0>, 'REMOTE_ADDR': '127.0.0.1', 'HTTP_ACCEPT_LANGUAGE': 'zh-CN,zh;q=0.8,en-US;q=0.6,en;q=0.4', 'CONTENT_TYPE': '', 'HTTP_ACCEPT_ENCODING': 'gzip, deflate, br'}



#### LocalProxy ç±»çš„__init__æ–¹æ³•
```
 def __init__(self, local, name=None):
        object.__setattr__(self, '_LocalProxy__local', local)
        object.__setattr__(self, '__name__', name)
```

è¿™ä¸ªåœ°æ–¹ä¸ºä½•æ˜¯ç”¨`object.__setattr__`è€Œä¸æ˜¯ç”¨`self.name = name`çš„æ–¹å¼

This method is called instead of the normal mechanism (i.e. store the value in the instance dictionary).

If __setattr__() wants to assign to an instance attribute, it should not simply execute self.name = value â€” this would cause a recursive call to itself.

Instead, it should insert the value in the dictionary of instance attributes, e.g., self.__dict__[name] = value.

For new-style classes, rather than accessing the instance dictionary, it should call the base class method with the same name, for example,

>>> object.__setattr__(self, name, value).


ref:

https://github.com/pallets/werkzeug/blob/0.6.1/werkzeug/local.py

https://github.com/pallets/flask/blob/0.1/flask.py

https://stackoverflow.com/a/38945407/995394
